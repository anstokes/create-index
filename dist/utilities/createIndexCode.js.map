{"version":3,"file":"createIndexCode.js","names":["safeVariableName","fileName","caseConversion","safeFileName","stringHelpers","hyphenToPascalCase","hyphenToSnakeCase","hyphenToCamelCase","indexOfDot","indexOf","slice","buildExportBlock","directoryPath","files","options","lineEnding","noSemicolons","classCase","config","case","toLowerCase","prefix","suffix","importBlock","_","map","importContents","importPath","path","resolve","fs","statSync","isDirectory","readFileSync","err","defaultExport","DEFAULT_EXPORT_PATTERN","test","safeName","className","capitaliseFirstLetter","exportAs","exportType","join","filePaths","code","configCode","header","headers","isArray","forEach","size","JSON","stringify","length","sortedFilePaths","sort"],"sources":["../../src/utilities/createIndexCode.js"],"sourcesContent":["/**\n * @author    Adrian Stokes <adrian@anstech.co.uk>\n * @company   ANSTECH Limited\n * @copyright 2023 ANSTECH Limited\n * @license   None, all rights reserved\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport _ from 'lodash';\n\nimport stringHelpers from './stringHelpers';\nimport { DEFAULT_EXPORT_PATTERN } from './constants';\n\nconst safeVariableName = (fileName, caseConversion) => {\n  let safeFileName = fileName;\n\n  switch (caseConversion) {\n    case 'pascal':\n      safeFileName = stringHelpers.hyphenToPascalCase(fileName);\n      break;\n\n    case 'snake':\n      safeFileName = stringHelpers.hyphenToSnakeCase(fileName);\n      break;\n\n    case 'camel':\n      safeFileName = stringHelpers.hyphenToCamelCase(fileName);\n      break;\n\n    default:\n    // No conversion\n  }\n\n  // Remove file extension\n  const indexOfDot = safeFileName.indexOf('.');\n\n  if (indexOfDot === -1) {\n    return safeFileName;\n  }\n  return safeFileName.slice(0, indexOfDot);\n};\n\nconst buildExportBlock = (directoryPath, files, options) => {\n  const lineEnding = options.lineEnding || options.noSemicolons ? '' : ';';\n  const classCase = ((options.config && options.config.case) || '').toLowerCase();\n  const prefix = (options.config && options.config.prefix) || '';\n  const suffix = (options.config && options.config.suffix) || '';\n\n  let importBlock;\n  importBlock = _.map(files, (fileName) => {\n    // Default behaviour\n    let importContents = 'export default';\n\n    if (directoryPath) {\n      try {\n        let importPath = path.resolve(directoryPath, fileName);\n\n        // Check if directory\n        if (fs.statSync(importPath).isDirectory()) {\n          // Read 'index.js' from the directory\n          importPath = path.resolve(importPath, 'index.js');\n        }\n\n        // Read the file\n        importContents = fs.readFileSync(importPath, 'utf-8');\n      } catch (err) {\n        // Unable to read file, revert to default behaviour\n      }\n    }\n\n    // Check for default export\n    const defaultExport = DEFAULT_EXPORT_PATTERN.test(importContents);\n\n    // Define the export name\n    const safeName = safeVariableName(fileName, classCase);\n    let className = safeName;\n    if (prefix) {\n      switch (classCase) {\n        // Same operation for camel and pascal case\n        case 'camel':\n        case 'pascal':\n          className = stringHelpers.capitaliseFirstLetter(safeName);\n          break;\n\n        case 'snake':\n          className = `_${className}`;\n          break;\n\n        default:\n        // No conversion\n      }\n    }\n    const exportAs = prefix + className + suffix;\n    const exportType = defaultExport ? `{ default as ${exportAs} }` : `* as ${exportAs}`;\n\n    return `export ${exportType} from './${safeVariableName(fileName)}'${lineEnding}`;\n  });\n\n  importBlock = importBlock.join('\\n');\n\n  return importBlock;\n};\n\nexport default (directoryPath, filePaths, options = {}) => {\n  let code;\n  let configCode;\n\n  code = '';\n  configCode = '';\n\n  if (options.header) {\n    const headers = _.isArray(options.header) ? options.header : [options.header];\n\n    headers.forEach((header) => {\n      code += `${header}\\n`;\n    });\n\n    code += '\\n';\n  }\n\n  if (options.config && _.size(options.config) > 0) {\n    configCode += ` ${JSON.stringify(options.config)}`;\n  }\n\n  code += `// @create-index${configCode}\\n`;\n\n  if (filePaths.length) {\n    const sortedFilePaths = filePaths.sort();\n\n    code += `\\n${buildExportBlock(directoryPath, sortedFilePaths, options)}\\n`;\n  }\n\n  return code;\n};\n"],"mappings":"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"}